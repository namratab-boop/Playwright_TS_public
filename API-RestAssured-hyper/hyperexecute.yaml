version: 0.1
globalTimeout: 90
testSuiteTimeout: 90
testSuiteStep: 90

runson: win

autosplit: true

retryOnFailure: true
maxRetries: 1

concurrency: 1


cacheKey: '{{ checksum "pom.xml" }}'
cacheDirectories:
  - $CACHE_DIR

pre:
  # 1. Standard sample command to handle the cache directory
  # 2. Build the project using the cache
  - mvn -Dmaven.repo.local=./.m2 dependency:resolve

testDiscovery:
  type: raw
  mode: remote
  # Corrected command to look specifically into your folder
  command: grep 'class name' src/test/java/web.xml | awk -F'"' '{print $2}'

# Fixed: Using the backtick (`) syntax from the working sample for Windows
testRunnerCommand: mvn test `-Dtest=$test `-Dbrowser=chrome `-Dversion=latest `-Dplatform="Windows 10" `-DsuiteXmlFile=src/test/java/web.xml

post:
  - mvn test -Dtest=postapi -DsuiteXmlFile=src/test/java/testing.xml

mergeArtifacts: true
uploadArtefacts:
  - name: Report
    path:
      - target/surefire-reports/**
  - name: sessionjson
    path:
      - session.json

jobLabel: ['API_REST_ASSURED', 'SELENIUM']